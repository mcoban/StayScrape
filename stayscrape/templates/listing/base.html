{% load static %}
{% load rental_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<title>{% if place.meta_title %}{{ place.meta_title }}{% else %}Holiday Villas in {{ place.name }} For Rent | StayScrape{% endif %}</title>
	<link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}">
	<link rel="stylesheet" href="{% static "css/custom.css" %}">
	<link rel="icon" type="image/png" sizes="32x32" href="{% static "img/favicon.png" %}">
	{% block "headerSeo" %}{% endblock %}
</head>

<body id="listing">
	
	<nav class="navbar navbar-stayScrape">
		<div class="container">
			<div class="navbar-header">
				<a href="{{ settings.SITE_URL }}" class="navbar-brand"></a>
			</div>
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#">Destinaions</a></li>
				<li><a href="#">Places</a></li>
				<li><a href="#">Blog</a></li>
			</ul>
		</div>
	</nav>
	<div class="filter-bar">
		<div class="container-fluid">
			<div class="row">
				<div class="col-xs-18 col-sm-7 col-md-5">
					<div class="input-container" id="place-input-container">
						<input type="text" class="place-input" placeholder="Type a place that you want to stay">
						<i class="icon search right"></i>
					</div>
				</div>
				<div class="col-xs-5 col-sm-2 col-md-1">
					<div class="dropdown">
					    <button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown"> Guests
					    <span class="caret"></span></button>
						<ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">1</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">2</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">3</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">4</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">5</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">6</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">7+</a></li>
					    </ul>
					</div>
				</div>
				<div class="col-xs-3 col-sm-6 col-md-1">
					<div class="dropdown">
					    <button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">Order By
					    <span class="caret"></span></button>
						<ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Price Low to High <span class="envelope"></span></a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Price High to Low</a></li>
							<li role="presentation" class="divider"></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Sleeps Low to High</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Sleeps High to Low</a></li>
							<li role="presentation" class="divider"></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Bedrooms Low to High</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Bedrooms High to Low</a></li>
							<li role="presentation" class="divider"></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Bathrooms Low to High</a></li>
							<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Bathrooms High to Low</a></li>
					    </ul>
					</div>
				</div>
				<div class="col-xs-18 col-sm-3">
					<a href="#" class="btn search-button">Search</a>
				</div>
			</div>
		</div>
	</div>



	<div class="container-fluid">
		<div class="row">
			<div class="col-md-8">
				<div class="sortby-filter">
					{% if place.page_title %}
					<h1 class="page-title">{{ place.page_title }}</h1>
					{% else %}
					<h1 class="page-title">Villas in {{ place.name }}</h1>
					{% endif %}
					<span class="count">{{ pagination.start }}-{{ pagination.end }} of {{ place.count }} Holiday Villas</span>
				</div>
				{% if pagination.page == 1 and place.description %}
				<div class="description">
					{{ place.description }}
				</div>
				{% endif %}
				<div class="villas">
					<div class="row">
{% for rental in rentals %}
						<div class="col-sm-6 col-lg-4">
							<a href="{{ settings.SITE_URL }}/villa/{{ rental.id }}" class="villa">
								<div class="img-container" style="background-image:url({{ rental.galleryUrl }})"></div>
								<h3 class="title">Villa #{{ rental.id }} in {{ rental.longJSON.listing.primaryLocation.name }} with {{ rental.sleeps }} sleeps, {{ rental.bathrooms }} bathrooms, and {{ rental.bedrooms }} bedrooms</h3>
								<div class="amnetities">
									<div class="col">
										<span class="vicon sleeps"></span>
										<span class="val">{{ rental.sleeps }}</span>
									</div>
									<div class="col">
										<span class="vicon bathrooms"></span>
										<span class="val">{{ rental.bathrooms }}</span>
									</div>
									<div class="col">
										<span class="vicon bedrooms"></span>
										<span class="val">{{ rental.bedrooms }}</span>
									</div>
									<div class="col">
										<span class="val price">Â£ {{ rental.price }}</span>
									</div>
								</div>
							</a>
						</div>
{% endfor %}
					</div>
				</div>
				<div class="pagination">
					<span class="count">{{ pagination.page }} of {{ pagination.page_count }}</span>
					<div class="arrows">
						{% if pagination.prev %}
						<a href="{{ pagination.prev }}" class="prev">Prev</a>
						{% endif %}
						{% if pagination.next %}
						<a href="{{ pagination.next }}" class="next">Next</a>
						{% endif %}
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div id="map">
					<div id="villas-map"></div>
				</div>
<!--				<div id="description">
					<h4>{{ place.name }} holiday</h4>
				</div>-->
			</div>
		</div>
	</div>

	<footer>
		<div class="container">
			<div class="row">
				<div class="col-xs-18 col-sm-2 footer-logo-section">
					<a href="#" class="footer-brand"></a>
				</div>
				<div class="col-xs-18 col-sm-6 col-md-4 pull-right">
					{% block "social" %}{% endblock %}
				</div>
			</div>
		</div>
	</footer>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
<script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
<link rel="stylesheet" href="{% static "css/mapbox.css" %}" />
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


<script>
L.mapbox.accessToken = 'pk.eyJ1Ijoic3RheXNjcmFwZSIsImEiOiJjaXpjdzVpdDIxbmhtMzJxb3FzeW10d2JrIn0.CV-uNOleGhjFI01yRCaxaw';
var mapTooltipsJS = L.mapbox.map('villas-map', 'mapbox.streets')
  // .setView([{{ rentals.0.json.geoCode.latitude }}, {{ rentals.0.json.geoCode.longitude }}], 4);
var myLayer = L.mapbox.featureLayer().addTo(mapTooltipsJS);
var markers = [];
var geojson = [
{% for rental in rentals %}
	markers.push([{{ rental.json.geoCode.latitude }}, {{ rental.json.geoCode.longitude }}]),
	{
		type: 'Feature',
	    geometry: {
	      type: 'Point',
	      coordinates: [{{ rental.json.geoCode.longitude }}, {{ rental.json.geoCode.latitude }}]
	    },
	    properties: {
	    	'title': 'Villa #{{ rental.id }} in {{ rental.longJSON.listing.primaryLocation.name }}',
	    	'image': '{{ rental.galleryUrl }}',
	    	'url': '{{ settings.SITE_URL }}/villa/{{ rental.id }}',
	      	'marker-color': '#3e6bd0',
	      	'marker-size': 'large',
	      	'marker-symbol': 'town'
	    }
	},
{% endfor %}
];

// Set a custom icon on each marker based on feature properties.
myLayer.on('layeradd', function(e) {
	var marker = e.layer,
		feature = marker.feature;
  	var content = '<a href="' + feature.properties.url + '"><img src="' + feature.properties.image + '"><span>' + feature.properties.title + '</span></a>';
  	marker.bindPopup(content);
});
myLayer.setGeoJSON(geojson);
mapTooltipsJS.fitBounds(markers);
mapTooltipsJS.scrollWheelZoom.disable();

myLayer.on('click', function(e) {
	mapTooltipsJS.panTo(e.layer.getLatLng());
})

</script>



</body>
</html>